!function(a){var b=this,c="http://"+httpUrl+"/biz/rest/share/draw/out/coupon",d="http://"+httpUrl+"/biz/rest/share/wechat/token",e=document.getElementById("phone_input"),f=document.getElementById("button_get"),g=document.getElementById("openxmlife"),h=document.getElementById("download_btn"),i=document.getElementById("mask"),j=/^[\d]{11}$/,k=window.wx,l=function(){var b=function(b,c,d,e){var f=document.getElementById("logo").src,g="你的菜钱我出了！快来抢红包一起用~",h="蔬果生鲜，食品百货：超市代买，1小时速达！";k.config({debug:!1,appId:b,nonceStr:d,timestamp:c,signature:e,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"]}),k.ready(function(){k.onMenuShareTimeline({title:g,link:"",imgUrl:f}),k.onMenuShareAppMessage({title:g,desc:h,link:"",imgUrl:f,type:"",dataUrl:""}),k.onMenuShareQQ({title:g,desc:h,link:"",imgUrl:f}),k.onMenuShareWeibo({title:g,desc:h,link:"",imgUrl:f}),k.hideOptionMenu()}),a.addClass(i,"fade")},c=function(a){var c=a.appId,d=a.timestamp,e=a.nonceStr,f=a.signature;b(c,d,e,f)},e=function(){};$.ajax({url:d,type:"GET",data:{url:window.location.href.split("#")[0]},dataType:"jsonp",jsonp:"jsoncallback",success:c,error:e})};l();var m=function(a){var b='<table width="100%" class="singleWinner"><tr><td><span class="userName">{name}</span><span class="timeStamp">{timeStamp}</span></td><td><span rowspan="2" class="money">{amount}元</span> </td></tr><tr><td><span class="comment">{comment}</span></td></tr></table>',c="",d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},e=function(a){return String(a).replace(/[&<>"'\/]/g,function(a){return d[a]})},f=["买蔬果生鲜，就用小美快购！","买菜购物不出门，棒极了！","红包这么大！今天加个菜〜","今天菜钱有了，棒棒嗒！","以后在家就能逛超市了！","以后柴米油盐再也不用自己扛了！","再不用小美就落伍了！","谢壕龙恩〜","天天发红包你妈知道吗？","用小美，新鲜肉菜天天有〜","向来人品好〜手气爆棚！","不出门，鲜菜照有！","新鲜水果，美味到家！","帅哥送货上门哦〜"];$.each(a||[],function(a,d){var g=d.phone,h=d.gmtCreate||(new Date).getTime(),i=new Date(h);i=i.getMonth()+1+"-"+i.getDate()+" "+i.getHours()+":"+i.getMinutes()||"",g&&d.amount&&(c+=b.replace(/\{name\}/,e(g)).replace(/\{timeStamp\}/,i).replace(/\{amount\}/,d.amount/100).replace(/\{comment\}/,e(f[h%f.length])))}),c&&($("#winners").html(c),$(".winnersWrapper").removeClass("hide"))},n=function(){var b=e.value,d=a.getParameterByName("ruleId"),h=function(c){var d=c.isPass,e=c.errorCode,f=document.getElementById("get"),h=document.getElementById("count"),j=document.getElementById("amount"),k=document.getElementById("phone"),l=document.getElementById("result"),n=document.getElementById("coupon_open"),o=document.getElementById("failure_msg"),p=document.getElementById("success_msg"),q=document.getElementById("failure_title"),r=document.getElementById("failure_desc"),s=document.getElementById("desc_panel"),t=(document.getElementsByClassName("car-wrap"),{802:["您的卡券太多啦!","赶紧去花掉一些~"],806:["今天领了很多啦!","明天再接再厉哦~"],823:["领过了!","留点机会给别人吧~"],820:["过期了!","下次早点来哦~"],821:["过期了!","下次早点来哦~"],expired:["过期了!","下次早点来哦~"],other:["领完啦!","下次早点来哦~"]}),u="",v="";a.addClass(f,"hide"),a.removeClass(l,"hide"),a.removeClass(n,"hide"),d?(h.innerHTML=c.count,j.innerHTML=(c.totalDiscount/100).toFixed(2)+"元",k.innerHTML=b,a.addClass(s,"desc-success"),a.removeClass(p,"hide")):(t[e]?(u=t[e][0],v=t[e][1]):(u=t.other[0],v=t.other[1]),q.innerHTML=u,r.innerHTML=v,a.addClass(s,"desc-failure"),a.removeClass(o,"hide")),m(c.records),a.removeClass(g,"hide"),a.addClass(i,"fade")},j=function(){alert("获取失败！"),a.removeClass(i,"fade")};a.hasClass(f,"active")&&(a.addClass(i,"fade"),$.ajax({url:c,type:"GET",data:{phone:b,ruleId:d},dataType:"jsonp",jsonp:"jsoncallback",success:h,failure:j}))};a.addEvent(e,"input",function(){j.test(e.value)?a.addClass(f,"active"):a.removeClass(f,"active")}),a.addEvent(f,"touchstart",function(){j.test(e.value)&&(a.hasClass(f,"active")?a.removeClass(f,"active"):null)},b),a.addEvent(f,"touchend",function(){j.test(e.value)&&(a.hasClass(f,"active")?null:a.addClass(f,"active"),n())}),a.addEvent(g,"touchstart",function(){a.hasClass(g,"active")?null:a.addClass(g,"active")},b),a.addEvent(g,"touchend",function(){a.hasClass(g,"active")?a.removeClass(g,"active"):null,window.location.href=a.downloadURL},b),a.addEvent(h,"touchstart",function(){a.hasClass(h,"active")?null:a.addClass(h,"active")},b),a.addEvent(h,"touchend",function(){a.hasClass(h,"active")?a.removeClass(h,"active"):null,window.location.href=a.downloadURL},b)}(XMLife);